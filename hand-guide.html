<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kawthoolei Karen Typing Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .scrollbar-hidden::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hidden {
            scrollbar-width: none;
        }

        .error-popup {
            position: fixed;
            top: 8rem;
            left: 50%;
            transform: translateX(-50%);
            background: #ef4444;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            z-index: 1000;
            animation: slideDown 0.3s ease, slideUp 0.3s ease 1.7s;
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }

            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }

            to {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
        }

        .key {
            transition: all 0.15s ease;
        }

        .key:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .key.active {
            background: #3b82f6 !important;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
        }

        .highlighted-char {
            background: #3b82f6;
            color: white;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            animation: pulse 1s infinite;
        }

        .correct-char {
            background: #10b981;
            color: white;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
        }

        /* for pop up  */
        .game-complete-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 520px;
            height: 300px;

            /* Background with image and gradient overlay */
            background-image:
                linear-gradient(135deg, rgba(102, 126, 234, 0.7), rgba(118, 75, 162, 0.7)),
                url('karen flag.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;

            backdrop-filter: blur(5px);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 30px;
            z-index: 2000;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: popupSlideIn 0.4s ease-out;

            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }


        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1999;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes popupSlideIn {
            from {
                transform: translate(-50%, -50%) scale(0.7);
                opacity: 0;
            }

            to {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .popup-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .popup-stats {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .popup-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 4px 5px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .popup-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .game-container {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        .keyboard-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>

<body class="flex flex-col min-h-screen bg-gradient-to-br from-blue-500 to-purple-600">
    <main class="flex-grow">
        <div class="container mx-auto px-4 pt-2 pb-1">
            <!-- Header -->
            <div class="flex justify-between items-center mb-2">
                <!-- Logo and Title -->
                <div class="flex items-center space-x-4">
                    <div class="w-16 h-16 border border-2 rounded-full overflow-hidden flex flex-col">
                        <div class="flex-1 bg-red-700"></div>
                        <div class="flex-1 bg-white"></div>
                        <div class="flex-1 bg-blue-800"></div>
                    </div>
                    <h1 class="text-2xl font-bold text-white">Kawthoolei Karen Typing Game With Dtacer Lin</h1>
                </div>

                <!-- Stats -->
                <div class="flex space-x-4 items-center">
                    <div
                        class="stat-card px-4 rounded-lg justify-center h-12 items-center border border-2 border-blue-300 flex text-center">
                        <a href="index.html" class="text-sm font-medium text-gray-800">Home</a>
                    </div>
                    <div class="stat-card px-4 py-2 rounded-lg text-center">
                        <div class="text-sm font-medium text-gray-600">Score</div>
                        <div id="score" class="text-xl font-bold text-blue-600">0</div>
                    </div>
                    <div class="stat-card px-4 py-2 rounded-lg text-center">
                        <div class="text-sm font-medium text-gray-600">Accuracy</div>
                        <div id="accuracy" class="text-xl font-bold text-green-600">100%</div>
                    </div>
                    <div class="stat-card px-4 py-2 rounded-lg text-center">
                        <div class="text-sm font-medium text-gray-600">Errors</div>
                        <div id="errors" class="text-xl font-bold text-red-600">0</div>
                    </div>
                    <div class="stat-card px-4 py-2 rounded-lg text-center">
                        <div class="text-sm font-medium text-gray-600">WPM</div>
                        <div id="wpm" class="text-xl font-bold text-purple-600">0</div>
                    </div>
                </div>
            </div>

            <!-- Main Container (Flexbox) -->
            <div class="flex w-full">
                <!-- Game Area (80% of the container) -->
                <div class="game-container w-4/5 rounded-xl px-6 pt-2 mb-1">
                    <!-- Display -->
                    <div class="mb-2 overflow-x-auto whitespace-nowrap scrollbar-hidden bg-white rounded-lg px-3 py-2 border-2 border-gray-200"
                        id="display-container">
                        <div id="display-text" class="text-2xl font-mono leading-relaxed inline-block">
                            ·Äî·ÄÄ·Äê·Ä≤·Å•·Ä∫·ÄÄ·Äê·ÄÆ·Å§·Äî·Äû·Ä∏·Äú·Å¢·Äî·ÄÄ·Äí·Ä≠·Äú·Ä∂·Äß·Ä´.....
                        </div>
                    </div>

                    <!-- User Input -->
                    <div class="overflow-x-auto whitespace-nowrap scrollbar-hidden bg-gray-100 rounded-lg px-3 py-2 border-2 border-gray-300"
                        id="input-container">
                        <div id="user-input"
                            class="text-2xl font-mono leading-relaxed inline-block min-h-[2rem] text-blue-600"></div>
                    </div>

                    <input type="text" id="hidden-input" class="sr-only" autocomplete="off" />

                </div>

                <!-- Control Buttons (18% of the container) -->
                <div class="w-1/5 px-4 py-1 rounded-lg">
                    <div class="flex flex-col space-y-2">
                        <button id="start-btn"
                            class="w-full px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors">
                            Start Game
                        </button>
                        <button id="pause-btn"
                            class="w-full px-6 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg font-medium transition-colors"
                            disabled>
                            Pause
                        </button>
                        <button id="exit-btn"
                            class="w-full px-6 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors">
                            Exit
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Keyboard -->
        <div class="keyboard-container container rounded-xl px-4 mx-auto py-1">
            <!-- Hint -->
            <div class="flex justify-center items-center">
                <!-- <div class="mb-2 text-center ">
                <div class="text-lg font-medium text-gray-700">
                    Type: <span id="hint-text" class="text-blue-600 font-bold">Press Start to begin</span>
                </div>
            </div> -->
                <div class="mb-2 bg-blue-100 rounded-lg px-3 py-1 border-2 border-blue-300">
                    <div id="type-hint" class="text-xl font-bold text-blue-800 text-center">
                        Type: <span id="hint-character" class="text-2xl bg-blue-200 px-2 py-1 rounded"></span>
                    </div>
                </div>
            </div>

            <!-- Keyboard Layout -->
            <div class="space-y-1">
                <!-- Row 1 -->
                <div class="flex justify-center space-x-1">
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="`">
                        ·Äî·Å§&nbsp;&nbsp;~<br>`</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="1">
                        ·ÅÅ&nbsp;&nbsp;!<br>1</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="2">
                        ·ÅÇ&nbsp;&nbsp;@<br>2</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="3">
                        ·ÅÉ&nbsp;&nbsp;#<br>3</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="4">
                        ·ÅÑ&nbsp;&nbsp;$<br>4</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="5">
                        ·ÅÖ&nbsp;&nbsp;%<br>5</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="6">
                        ·ÅÜ&nbsp;&nbsp;^<br>6</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="7">
                        ·Äõ&nbsp;&nbsp;·Åá<br>7</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="8">
                        ·ÄÇ&nbsp;&nbsp;·Åà<br>8</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="9">
                        (&nbsp;&nbsp;·Åâ·Ä≠<br>9</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="0">
                        )&nbsp;&nbsp;·ÅÄ<br>0</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="-">
                        _&nbsp;&nbsp;-<br>-</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="=">
                        +&nbsp;&nbsp;=<br>=</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono" data-key="Backspace">Backspace
                    </div>
                </div>

                <!-- Row 2 -->
                <div class="flex justify-center space-x-1">
                    <div class="key bg-gray-200 px-8 py-2 rounded text-center font-mono" data-key="Tab">Tab</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="q">
                        ·Å°&nbsp;&nbsp;·ÄÜ <br>Q</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="w">
                        ·Äù&nbsp;&nbsp;·Äê<br>W</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="e">
                        ·Å¢·Å¢·Ä∫&nbsp;&nbsp;·Äî<br>E</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="r">
                        ·Å¢·Å•·Ä∫&nbsp;&nbsp;·Äô<br>R</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="t">
                        ·Å¢·Å•·Ä∫&nbsp;&nbsp;·Ä°<br>T</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="y">
                        ·Å¢·Å£·Ä∫&nbsp;&nbsp;·Äï<br>Y</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="u">
                        ·ÄΩ·Ä∑&nbsp;&nbsp;·ÄÄ<br>U</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="i">
                        .&nbsp;&nbsp;·ÄÑ<br>I</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="o">
                        ·Äæ·ÄØ&nbsp;&nbsp;·Äû<br>O</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="p">
                        ·Å¶&nbsp;&nbsp;·ÄÖ<br>P</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="[">
                        ·Äß&nbsp;&nbsp;·Äü<br>[</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="]">
                        ‚ú©&nbsp;&nbsp;·Åú<br>]</div>
                    <div class="key bg-gray-200 px-8 py-1 rounded text-center font-mono" data-key="\\">\\</div>
                </div>

                <!-- Row 3 -->
                <div class="flex justify-center space-x-1">
                    <div class="key bg-gray-200 px-10 py-2 rounded text-center font-mono" data-key="CapsLock">Caps</div>
                    <div class="key bg-gray-200 px-5 py-1 rounded text-center font-mono min-w-[3rem]" data-key="a">
                        ·Äô·Ä∫&nbsp;&nbsp;·Äí·Ä∫<br>A</div>
                    <div class="key bg-gray-200 px-5 py-1 rounded text-center font-mono min-w-[3rem]" data-key="s">
                        ·Äæ&nbsp;&nbsp;·Äª<br>S</div>
                    <div class="key bg-gray-200 px-5 py-1 rounded text-center font-mono min-w-[3rem]" data-key="d">
                        ·ÄÆ&nbsp;&nbsp;·Ä≠<br>D</div>
                    <div class="key bg-gray-200 px-5 py-1 rounded text-center font-mono min-w-[3rem]" data-key="f">
                        ·Å†&nbsp;&nbsp;·ÄÖ·ÄÆ·Å§<br>F</div>
                    <div class="key bg-gray-200 px-5 py-1 rounded text-center font-mono min-w-[3rem]" data-key="g">
                        ·ÄΩ&nbsp;&nbsp;·Ä´<br>G</div>
                    <div class="key bg-gray-200 px-5 py-1 rounded text-center font-mono min-w-[3rem]" data-key="h">
                        ·Ä∂&nbsp;&nbsp;·Ä∑<br>H</div>
                    <div class="key bg-gray-200 px-5 py-1 rounded text-center font-mono min-w-[3rem]" data-key="j">
                        ·Ä≤&nbsp;&nbsp;·Äº<br>J</div>
                    <div class="key bg-gray-200 px-5 py-1 rounded text-center font-mono min-w-[3rem]" data-key="k">
                        ·Äí&nbsp;&nbsp;·ÄØ<br>K</div>
                    <div class="key bg-gray-200 px-5 py-1 rounded text-center font-mono min-w-[3rem]" data-key="l">
                        ·Äú·ÄÆ·Å§&nbsp;&nbsp;·Ä∞<br>L</div>
                    <div class="key bg-gray-200 px-5 py-1 rounded text-center font-mono min-w-[3rem]" data-key=";">
                        ·Äí·ÄÆ·Ä∏&nbsp;&nbsp;·Ä∏<br>;</div>
                    <div class="key bg-gray-200 px-5 py-1 rounded text-center font-mono min-w-[3rem]" data-key="'">
                        ·Åã&nbsp;&nbsp;·Åä<br>'</div>
                    <div class="key bg-gray-200 px-10 py-1 rounded text-center font-mono" data-key="Enter">Enter</div>
                </div>

                <!-- Row 4 -->
                <div class="flex justify-center space-x-1">
                    <div class="key bg-gray-200 px-14 py-2 rounded text-center font-mono" data-key="Shift">Shift</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="z">
                        ·Äá&nbsp;&nbsp;·Äñ<br>Z</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="x">
                        ·Å¢&nbsp;&nbsp;·Äë<br>X</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="c">
                        ·ÄÉ&nbsp;&nbsp;·ÄÅ<br>C</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="v">
                        ·Äª·Ä∑&nbsp;&nbsp;·Äú<br>V</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="b">
                        ·Äæ·Ä∑&nbsp;&nbsp;·Äò<br>B</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="n">
                        ·Äî·ÄÆ·Å¢·Ä∫&nbsp;&nbsp;·Ää<br>N</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key="m">
                        ·Äî·Ä∑·Å£·Ä∫&nbsp;&nbsp;·Å•·Ä∫<br>M</div>
                    <div class="key bg-gray-200 px-3 py-1 rounded text-center font-mono min-w-[3rem]" data-key=",">
                        ,&nbsp;&nbsp;·Äö<br>,</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key=".">
                        ·Å¢·Ä∫&nbsp;&nbsp;·Å£·Ä∫<br>.</div>
                    <div class="key bg-gray-200 px-4 py-1 rounded text-center font-mono min-w-[3rem]" data-key="/">
                        ?&nbsp;&nbsp;/<br>/</div>
                    <div class="key bg-gray-200 px-14 py-1 rounded text-center font-mono" data-key="Shift">Shift</div>
                </div>

                <!-- Row 5 -->
                <div class="flex justify-center space-x-1">
                    <div class="key bg-gray-200 px-6 py-2 rounded text-center font-mono" data-key="Ctrl">Ctrl</div>
                    <div class="key bg-gray-200 px-6 py-2 rounded text-center font-mono" data-key="Ctrl">Fn</div>
                    <div class="key bg-gray-200 px-6 py-2 rounded text-center font-mono" data-key="Ctrl">Win</div>
                    <div class="key bg-gray-200 px-6 py-2 rounded text-center font-mono" data-key="Alt">Alt</div>
                    <div class="key bg-gray-200 pl-56 pr-60 py-2 rounded text-center font-mono" data-key=" ">Space</div>
                    <div class="key bg-gray-200 px-10 py-2 rounded text-center font-mono" data-key="Alt">Alt</div>
                    <div class="key bg-gray-200 px-10 py-2 rounded text-center font-mono" data-key="Ctrl">Ctrl</div>
                </div>
            </div>
        </div>
    </main>
    <!-- Footer -->
    <footer class="gradient-bg text-white py-0 my-1 ">
        <div class="container mx-auto px-4 text-center">
            <p class="text-lg font-medium">
                ¬© Saw Lay Bay (KDHW) All rights reserved!
            </p>
        </div>
    </footer>

    <!-- Background Music -->
    <audio id="background-music" loop>
        <source src="karen_song.mp3" type="audio/mpeg">
    </audio>

    <script>
        class KarenTypingGame {
            constructor() {
                // Karen character to key mapping with position notes
                this.karenMap = {
                    // Basic consonants
                    '·ÄÄ': 'u',
                    '·ÄÅ': 'c',
                    '·ÄÇ': '*',
                    '·ÄÉ': 'Shift+c',
                    '·ÄÑ': 'i',
                    '·ÄÖ': 'p',
                    '·ÄÜ': 'q',
                    '·Å°': 'Shift+q',
                    '·Ää': 'n',
                    '·Äê': 'w',
                    '·Äë': 'x',
                    '·Äí': 'Shift+k',
                    '·Äí·Ä∫': 'a',
                    '·Äî': 'e',
                    '·Äï': 'y',
                    '·Äñ': 'z',
                    '·Äò': 'b',
                    '·Äô': 'r',
                    '·Äö': ',',
                    '·Äõ': '&',
                    '·Äú': 'v',
                    '·Äù': 'Shift+w',
                    '·Äû': 'o',
                    '·Äü': '[',
                    '·Ä°': 't',
                    '·Äß': '{',

                    // Vowels and diacritics with their positions
                    '·Ä´': 'g',
                    '·Ä∂': 'Shift+h',
                    '·Å¢': 'Shift+x',
                    '·ÄØ': 'k',
                    '·Ä∞': 'l',
                    '·Ä∑': 'h',
                    '·Ä≤': 'Shift+j',
                    '·Ä≠': 'd',
                    '·ÄÆ': 'Shift+d',
                    '·Ä∏': ';',
                    '·Äº': 'j',
                    '·Äª': 's',
                    '·ÄΩ': 'Shift+g',
                    '·Äæ': 'Shift+s',

                    // Special combined characters - these are the key ones that need to work as single units
                    '·Å¢·Ä∫': '>',
                    '·Å£·Ä∫': '.',
                    '·Å•·Ä∫': 'm',
                    '·Å§': 'Shift+r',
                    '·Å†': 'Shift+f',
                    '·Äæ·Ä∑': 'Shift+b',
                    '·Äô·Ä∫': 'Shift+a',
                    '·Äí·Ä∫': 'a',

                    // Space
                    ' ': ' '
                };

                // Reverse mapping for key to Karen character
                this.keyToKaren = {};
                for (const [karen, key] of Object.entries(this.karenMap)) {
                    this.keyToKaren[key] = karen;
                }

                this.sampleText = "·ÄÄ ·ÄÅ ·ÄÇ ·ÄÉ ·ÄÑ ·ÄÖ ·ÄÜ ·Å° ·Ää ·Äê ·Äë ·Äí ·Äî ·Äï ·Äñ ·Äò ·Äô ·Äö ·Äõ ·Äú ·Äù ·Äû ·Äü ·Ä° ·Äß ·Ä´ ·Ä∂ ·Å¢ ·ÄØ ·Ä∞ ·Ä∑ ·Ä≤ ·Ä≠ ·ÄÆ ·Å¢·Ä∫ ·Å•·Ä∫ ·Ä∏ ·Å£·Ä∫ ·Å§ ·ÄÅ ·ÄÅ ·ÄÄ ·Äò ·Äò ·Äû ·ÄÄ ·ÄÅ ·ÄÇ ·ÄÉ ·ÄÑ ·ÄÖ ·ÄÜ ·Å° ·Ää ·Äê ·Äë ·Äí ·Äî ·Äï ·Äñ ·Äò ·Äô ·Äö ·Äõ ·Äú ·Äù ·Äû ·Äü ·Ä° ·Äß ·ÄÄ ·ÄÅ ·ÄÇ ·ÄÉ ·ÄÑ ·ÄÖ ·ÄÜ ·Ä´ ·Ä∂ ·Å¢ ·ÄØ ·Ä∞ ·Ä∑ ·Ä≤ ·Ä≠ ·ÄÆ ·ÄÄ ·ÄÅ ·ÄÖ ·ÄÜ ·Äº ·Äª ·Å† ·Äò ·Äñ ·Äõ ·Å° ·Ää ·Äê ·Äë ·Äí ·Äî ·Äï ·Äñ ·Äò ·Äô ·Äö ·Äõ ·Äú ·Äù ·Äû ·Äü ·Ä° ·Äß ·Äú ·Äò ·Äô ·Äö ·Äû ·Äù ·ÄÄ ·Å° ·Äú ·Äû ·ÄÖ  ·Ä´ ·Ä∂ ·Äë ·ÄÅ ·ÄÄ ·Äê ·Å¢ ·ÄÉ ·Å£·Ä∫ ·Äô·Å§ ·Äù·Ä∂·Å§·Äú·Ä∂·Äî·ÄÆ·Å£·Ä∫";
                this.currentIndex = 0;
                this.score = 0;
                this.errors = 0;
                this.totalTyped = 0;
                this.startTime = null;
                this.gameActive = false;
                this.isPaused = false;
                this.userInput = '';
                this.typedCharCount = 0; // Track the number of actual typed characters for scrolling

                this.initElements();
                this.initEventListeners();
                this.createSounds();
                this.updateDisplay();
            }

            initElements() {
                this.elements = {
                    displayText: document.getElementById('display-text'),
                    userInput: document.getElementById('user-input'),
                    startBtn: document.getElementById('start-btn'),
                    pauseBtn: document.getElementById('pause-btn'),
                    exitBtn: document.getElementById('exit-btn'),
                    score: document.getElementById('score'),
                    accuracy: document.getElementById('accuracy'),
                    errors: document.getElementById('errors'),
                    wpm: document.getElementById('wpm'),
                    hintText: document.getElementById('hint-text'),
                    backgroundMusic: document.getElementById('background-music')
                };

                this.keys = document.querySelectorAll('.key');
            }

            initEventListeners() {
                this.elements.startBtn.addEventListener('click', () => this.startGame());
                this.elements.pauseBtn.addEventListener('click', () => this.pauseGame());
                this.elements.exitBtn.addEventListener('click', () => this.exitGame());

                document.addEventListener('keydown', (e) => this.handleKeyPress(e));
                document.addEventListener('keyup', (e) => this.handleKeyRelease(e));
            }

            createSounds() {
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                this.correctSound = this.createBeep(800, 0.1, 'sine');
                this.errorSound = this.createBeep(300, 0.3, 'sawtooth');
            }

            createBeep(frequency, duration, type) {
                return () => {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);

                    oscillator.frequency.value = frequency;
                    oscillator.type = type;

                    gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);

                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + duration);
                };
            }

            startGame() {
                this.gameActive = true;
                this.isPaused = false;
                this.startTime = Date.now();
                this.currentIndex = 0;
                this.score = 0;
                this.errors = 0;
                this.totalTyped = 0;
                this.userInput = '';
                this.typedCharCount = 0;

                // ADD THIS: Reset the hint display
                const hintCharacterElement = document.getElementById('hint-character');
                if (hintCharacterElement) {
                    hintCharacterElement.textContent = "Ready to start...";
                    hintCharacterElement.className = "text-2xl bg-blue-200 px-2 py-1 rounded";
                }

                this.elements.startBtn.disabled = true;
                this.elements.pauseBtn.disabled = false;
                this.elements.backgroundMusic.play().catch(e => console.log('Audio play failed:', e));

                this.updateDisplay();
                this.highlightCurrentChar();
            }

            pauseGame() {
                if (this.gameActive) {
                    this.isPaused = !this.isPaused;
                    this.elements.pauseBtn.textContent = this.isPaused ? 'Resume' : 'Pause';

                    if (this.isPaused) {
                        this.elements.backgroundMusic.pause();
                    } else {
                        this.elements.backgroundMusic.play();
                    }
                }
            }

            exitGame() {
                if (confirm('Are you sure you want to exit the game?')) {
                    this.gameActive = false;
                    this.isPaused = false;
                    this.elements.startBtn.disabled = false;
                    this.elements.pauseBtn.disabled = true;
                    this.elements.pauseBtn.textContent = 'Pause';
                    this.elements.backgroundMusic.pause();
                    this.elements.backgroundMusic.currentTime = 0;

                    // ADD THIS: Reset all game values and hint
                    this.currentIndex = 0;
                    this.score = 0;
                    this.errors = 0;
                    this.totalTyped = 0;
                    this.userInput = '';
                    this.typedCharCount = 0;
                    this.startTime = null;

                    const hintCharacterElement = document.getElementById('hint-character');
                    if (hintCharacterElement) {
                        hintCharacterElement.textContent = "Ready to start...";
                        hintCharacterElement.className = "text-2xl bg-blue-200 px-2 py-1 rounded";
                    }

                    this.updateDisplay();
                    this.clearHighlight();
                }
            }

            resetGame() {
                this.currentIndex = 0;
                this.score = 0;
                this.errors = 0;
                this.totalTyped = 0;
                this.userInput = '';
                this.typedCharCount = 0;
                this.startTime = null;

                this.updateDisplay();
                this.clearHighlight();
            }

            clearHighlight() {
                this.keys.forEach(key => key.classList.remove('active'));
            }

            // Get the next character(s) that need to be typed, handling combined characters
            getNextCharacterInfo() {
                if (this.currentIndex >= this.sampleText.length) {
                    return null;
                }

                // List of combined characters in order of length (longest first)
                const combinedChars = ['·Å¢·Ä∫', '·Å£·Ä∫', '·Å•·Ä∫', '·Äæ·Ä∑'];

                // Check for combined characters
                for (const combined of combinedChars) {
                    if (this.sampleText.substr(this.currentIndex, combined.length) === combined) {
                        return {
                            char: combined,
                            length: combined.length
                        };
                    }
                }

                // Single character
                return {
                    char: this.sampleText[this.currentIndex],
                    length: 1
                };
            }

            handleKeyPress(e) {
                if (!this.gameActive || this.isPaused) return;

                if (this.audioContext.state === 'suspended') {
                    this.audioContext.resume();
                }

                const key = this.getKeyFromEvent(e);

                // Highlight both Shift and the target key for shifted characters
                if (e.shiftKey && key !== 'Shift') {
                    this.highlightKey('Shift', true);
                }
                this.highlightKey(key, true);

                if (key === 'Shift') {
                    e.preventDefault();
                    return;
                }

                // Get current character(s) - handle combined characters
                const charInfo = this.getNextCharacterInfo();
                if (!charInfo) {
                    this.endGame();
                    return;
                }

                const currentChar = charInfo.char;
                const charLength = charInfo.length;
                const expectedKey = this.karenMap[currentChar];

                // Ignore modifier keys alone (Ctrl, Alt)
                if (key === 'Ctrl' || key === 'Alt') {
                    e.preventDefault();
                    return;
                }

                // Handle Backspace, Tab, Enter, etc. (don't count as errors)
                if (['Backspace', 'Tab', 'Enter', 'CapsLock'].includes(key)) {
                    e.preventDefault();
                    return;
                }

                // Construct the actual key combination that was pressed
                let actualKey = key;
                if (e.shiftKey && key !== 'Shift') {
                    // Handle number keys with Shift
                    if (key.match(/^[0-9]$/)) {
                        actualKey = `Shift+${key}`;
                    }
                    // Handle special characters with Shift - including period
                    else if (key.match(/^[-=\[\]\\;',.\/`]$/)) {
                        // Special case for period with Shift - it becomes >
                        if (key === '.') {
                            actualKey = '>';
                        } else {
                            actualKey = `Shift+${key}`;
                        }
                    }
                    // Handle letters with Shift
                    else if (key.match(/^[a-z]$/)) {
                        actualKey = `Shift+${key.toLowerCase()}`;
                    }
                }

                // Special case for space
                if (key === ' ') {
                    actualKey = ' ';
                }

                if (actualKey === expectedKey) {
                    this.handleCorrectInput(currentChar, charLength);
                } else {
                    this.handleErrorInput();
                }

                this.updateStats();
                this.highlightCurrentChar();

                e.preventDefault();
            }

            handleCorrectInput(char, length = 1) {
                this.userInput += char;
                this.currentIndex += length;
                this.score += 10;
                this.totalTyped++;
                this.typedCharCount++;

                this.correctSound();
                this.updateUserDisplay();
                this.scrollTextIfNeeded();

                // Check if game is complete AFTER updating the current index
                if (this.currentIndex >= this.sampleText.length) {
                    // Update stats one final time before showing results
                    this.updateStats();
                    // Small delay to allow final character to be processed visually
                    setTimeout(() => {
                        this.endGame();
                    }, 300);
                }
            }

            handleErrorInput() {
                this.errors++;
                this.totalTyped++;

                this.errorSound();
                this.showErrorPopup();
            }

            handleKeyRelease(e) {
                const key = this.getKeyFromEvent(e);
                this.highlightKey(key, false);

                if (key !== 'Shift' && e.shiftKey) {
                    this.highlightKey('Shift', false);
                }
            }

            getKeyFromEvent(e) {
                if (e.key === ' ') return ' ';
                if (e.key === 'Shift') return 'Shift';
                if (e.key === 'Backspace') return 'Backspace';
                if (e.key === 'Tab') return 'Tab';
                if (e.key === 'Enter') return 'Enter';
                if (e.key === 'CapsLock') return 'CapsLock';
                if (e.key === 'Control') return 'Ctrl';
                if (e.key === 'Alt') return 'Alt';
                if (e.key === 'Meta') return 'Meta';

                // Handle number keys
                if (e.key.match(/^[0-9]$/)) {
                    return e.key;
                }

                // Handle other keys (convert to lowercase)
                return e.key.toLowerCase();
            }

            highlightKey(key, isPressed) {
                this.keys.forEach(keyElement => {
                    if (keyElement.dataset.key === key) {
                        if (isPressed) {
                            keyElement.classList.add('active');
                        } else {
                            keyElement.classList.remove('active');
                        }
                    }
                });
            }

            showErrorPopup() {
                const popup = document.createElement('div');
                popup.className = 'error-popup';
                popup.textContent = '·ÄÄ·ÄΩ·Å¢·Ä∫·Äú·ÄÆ·Å§·Äê·Ä∂·Å¢·Ä∫,·Äî·Äê·Å¢·Ä∫·ÄÄ·Äô·Å£·Ä∫·Äò·Å£·Ä∫·Ä°·Äû·Ä∏·Äú·Ä∂';
                document.body.appendChild(popup);

                setTimeout(() => {
                    if (document.body.contains(popup)) {
                        document.body.removeChild(popup);
                    }
                }, 2000);
            }

            updateUserDisplay() {
                const userInputElement = this.elements.userInput;
                userInputElement.innerHTML = '';

                if (this.userInput.length === 0) {
                    userInputElement.innerHTML = '<span class="text-gray-400">Your typing will appear here...</span>';
                } else {
                    // Display user input as plain text without individual character highlighting
                    userInputElement.textContent = this.userInput;
                }
            }
            scrollTextIfNeeded() {
                const displayContainer = document.getElementById('display-container');
                const inputContainer = document.getElementById('input-container');

                const containerWidth = displayContainer.offsetWidth;
                const charWidth = 24; // Approximate character width for text-2xl
                const visibleChars = Math.floor(containerWidth / charWidth);
                const scrollThreshold = Math.floor(visibleChars * 0.5); // 50% position

                if (this.typedCharCount > scrollThreshold) {
                    // Calculate how much to scroll to keep cursor at 80% position
                    const scrollAmount = (this.typedCharCount - scrollThreshold) * charWidth;

                    // Scroll both containers to keep the current position at 80%
                    displayContainer.scrollLeft = scrollAmount;
                    inputContainer.scrollLeft = scrollAmount;
                } else {
                    // Reset scroll when below threshold
                    displayContainer.scrollLeft = 0;
                    inputContainer.scrollLeft = 0;
                }
            }

            highlightCurrentChar() {
                const displayTextElement = this.elements.displayText;
                const hintCharacterElement = document.getElementById('hint-character');

                displayTextElement.innerHTML = '';

                // Clear keyboard highlights first
                this.keys.forEach(key => key.classList.remove('active'));

                // Get current character info and update hint
                if (this.currentIndex < this.sampleText.length) {
                    const charInfo = this.getNextCharacterInfo();
                    if (charInfo) {
                        const currentChar = charInfo.char;
                        const expectedKey = this.karenMap[currentChar];

                        // Update the hint display - show English key instead of Karen character
                        if (hintCharacterElement) {
                            // Show the English key that needs to be pressed
                            let hintText = expectedKey;

                            // Format the hint text for better display
                            if (expectedKey.includes('Shift+')) {
                                const mainKey = expectedKey.replace('Shift+', '');
                                hintText = `Shift + ${mainKey}`;
                            } else if (expectedKey === ' ') {
                                hintText = 'Space';
                            }

                            hintCharacterElement.textContent = hintText;
                            hintCharacterElement.className = "text-2xl bg-blue-200 px-2 py-1 rounded font-bold";
                        }

                        // Highlight the required keys on keyboard
                        if (expectedKey && expectedKey.includes('Shift+')) {
                            const mainKey = expectedKey.replace('Shift+', '').toLowerCase();
                            this.highlightKey('Shift', true);
                            this.highlightKey(mainKey, true);
                        } else if (expectedKey) {
                            this.highlightKey(expectedKey, true);
                        }
                    }
                } else {
                    // Game completed
                    if (hintCharacterElement) {
                        hintCharacterElement.textContent = "";
                        hintCharacterElement.className = "text-2xl bg-green-200 px-2 py-1 rounded font-bold";
                    }
                }

                // Display the text with proper highlighting - treat combined characters as single units
                let textIndex = 0;
                while (textIndex < this.sampleText.length) {
                    const charInfo = this.getCharacterInfoAtIndex(textIndex);
                    if (!charInfo) break;

                    const char = charInfo.char;
                    const charLength = charInfo.length;

                    const span = document.createElement('span');
                    span.textContent = char;

                    if (textIndex < this.currentIndex) {
                        span.className = 'correct-char';
                    } else if (textIndex === this.currentIndex) {
                        span.className = 'highlighted-char';
                    }

                    displayTextElement.appendChild(span);
                    textIndex += charLength;
                }

            }

            // Helper method to get character info at any index
            getCharacterInfoAtIndex(index) {
                if (index >= this.sampleText.length) {
                    return null;
                }

                // List of combined characters in order of length (longest first)
                const combinedChars = ['·Å¢·Ä∫', '·Å£·Ä∫', '·Å•·Ä∫', '·Äæ·Ä∑'];

                // Check for combined characters
                for (const combined of combinedChars) {
                    if (this.sampleText.substr(index, combined.length) === combined) {
                        return {
                            char: combined,
                            length: combined.length
                        };
                    }
                }

                // Single character
                return {
                    char: this.sampleText[index],
                    length: 1
                };
            }

            updateStats() {
                this.elements.score.textContent = this.score;
                this.elements.errors.textContent = this.errors;

                const accuracy = this.totalTyped > 0 ? ((this.totalTyped - this.errors) / this.totalTyped * 100).toFixed(1) : 100;
                this.elements.accuracy.textContent = accuracy + '%';

                if (this.startTime) {
                    const timeElapsed = (Date.now() - this.startTime) / 1000 / 60;
                    const wordsTyped = this.currentIndex / 5;
                    const wpm = timeElapsed > 0 ? Math.round(wordsTyped / timeElapsed) : 0;
                    this.elements.wpm.textContent = wpm;
                }
            }

            updateDisplay() {
                this.updateStats();
                this.updateUserDisplay();
            }

            endGame() {
                this.gameActive = false;
                this.elements.startBtn.disabled = false;
                this.elements.pauseBtn.disabled = true;
                this.elements.pauseBtn.textContent = 'Pause';
                this.elements.backgroundMusic.pause();

                const finalAccuracy = this.totalTyped > 0 ? ((this.totalTyped - this.errors) / this.totalTyped * 100).toFixed(1) : 100;
                const timeElapsed = (Date.now() - this.startTime) / 1000 / 60;
                const wordsTyped = this.currentIndex / 5;
                const finalWpm = timeElapsed > 0 ? Math.round(wordsTyped / timeElapsed) : 0;

                this.showGameCompletePopup(finalWpm, finalAccuracy, timeElapsed);
            }

            showGameCompletePopup(finalWpm, finalAccuracy, timeElapsed) {
                // Create overlay
                const overlay = document.createElement('div');
                overlay.className = 'popup-overlay';

                // Create popup
                const popup = document.createElement('div');
                popup.className = 'game-complete-popup';

                popup.innerHTML = `
        <div class="popup-title">üéâ Game Complete! üéâ</div>
        <div class="popup-stats">
            <div><strong>üèÜ </strong>·Äî·Äô·Å§·Äî·Ä∑·Å¢·Ä∫·Ä°·Äô·Ä∏·ÄÅ·Ä≤·Äú·Å¢·Å•·Ä∫: ${this.score} ·Äô·Ä∏</div>
            <div><strong>‚ö°</strong> ·Äê·Äô·Ä∂·Ä∏·Äî·Ä∂·Ä∏·Äî·Äí·Ä≠·Äú·Ä∂·Å•·Ä∫·Äî·Ä∑·Å¢·Ä∫: ${finalWpm} ·Äñ·Äª·Å¢·Å£·Ä∫</div>
            <div><strong>üéØ </strong>·Äô·Äª·Ä∏·ÄÄ·Äö·Å§·Äú·Å¢·Äî·Äí·Ä≠·Ä°·ÄÆ·Å§·Ä°·Äò·Å£·Ä∫: ${finalAccuracy}%</div>
            <div><strong>‚ùå </strong>·Ä°·ÄÄ·Äô·Å£·Ä∫·ÄÅ·Ä≤·Äú·Å¢·Å•·Ä∫: ${this.errors}</div>
            <div><strong>‚å®Ô∏è </strong>·Äú·Ä∂·Å•·Ä∫·Äô·Ä≤·Å•·Ä∫·Äñ·Äª·Å¢·Å£·Ä∫·ÄÅ·Ä≤·Äú·Å¢·Å•·Ä∫: ${this.currentIndex}</div>
            <div><strong>‚è±Ô∏è</strong> ·Äê·Å¢·Ä∫·ÄÜ·Å¢·ÄÄ·Äê·ÄÆ·Å¢·Ä∫: ${(timeElapsed * 60).toFixed(1)}s</div>
        </div>
        <button class="popup-close-btn">·Äí·Ä≠·ÄÄ·Äí·ÄÆ·Ä∏·Ä°·Äû·ÄÆ·Äê·Äò·Äª·ÄÆ</button>
    `;

                // Add click handler for close button
                const closeBtn = popup.querySelector('.popup-close-btn');
                closeBtn.addEventListener('click', () => {
                    document.body.removeChild(overlay);
                    document.body.removeChild(popup);
                });

                // Add click handler for overlay (close when clicking outside)
                overlay.addEventListener('click', () => {
                    document.body.removeChild(overlay);
                    document.body.removeChild(popup);
                });

                // Add to page
                document.body.appendChild(overlay);
                document.body.appendChild(popup);
            }
        }

        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new KarenTypingGame();
        });


    </script>
</body>

</html>